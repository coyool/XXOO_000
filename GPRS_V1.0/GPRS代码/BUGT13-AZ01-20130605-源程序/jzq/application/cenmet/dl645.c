/******************** *****(C) COPYRIGHT 2010 LOKEE ************************
* File Name :  dl645.c
* Author : 
* Version : 
* Date : 
* Description :DL/T645-1997规约抄表
*******************************************************************************
* 
*******************************************************************************/
#include "plat_include/sleep.h"

#include "app_include/cenmet/basetype.h"
#include "app_include/cenmet/metproto.h"
//#include "cenmet_proto.h"
#include "plat_include/debug.h"
#include "app_include/sys/rs485.h"

typedef struct {//type=0
	unsigned short cid;
	unsigned char  len;
} dl645_item_t;

#define DL645_NUMITEM    267

static const dl645_item_t dl645_item_tab[] = {
	//电能量78
	{0x9010, 4}, {0x9011, 4}, {0x9012, 4}, {0x9013, 4}, {0x9014, 4}, {0x901f, 20}, 
	{0x9020, 4}, {0x9021, 4}, {0x9022, 4}, {0x9023, 4}, {0x9024, 4}, {0x902f, 20}, 
	{0x9110, 4}, {0x9111, 4}, {0x9112, 4}, {0x9113, 4}, {0x9114, 4}, {0x911f, 20}, 
	{0x9120, 4}, {0x9121, 4}, {0x9122, 4}, {0x9123, 4}, {0x9124, 4}, {0x912f, 20}, 
	{0x9130, 4}, {0x9131, 4}, {0x9132, 4}, {0x9133, 4}, {0x9134, 4}, {0x913f, 20}, 
	{0x9140, 4}, {0x9141, 4}, {0x9142, 4}, {0x9143, 4}, {0x9144, 4}, {0x914f, 20}, 
	{0x9150, 4}, {0x9151, 4}, {0x9152, 4}, {0x9153, 4}, {0x9154, 4}, {0x915f, 20}, 
	{0x9160, 4}, {0x9161, 4}, {0x9162, 4}, {0x9163, 4}, {0x9164, 4}, {0x916f, 20}, 
	{0x9410, 4}, {0x9411, 4}, {0x9412, 4}, {0x9413, 4}, {0x9414, 4}, {0x941f, 20}, 
	{0x9420, 4}, {0x9421, 4}, {0x9422, 4}, {0x9423, 4}, {0x9424, 4}, {0x942f, 20}, 
	{0x9810, 4}, {0x9811, 4}, {0x9812, 4}, {0x9813, 4}, {0x9814, 4}, {0x981f, 20}, 
	{0x9510, 4}, {0x9511, 4}, {0x9512, 4}, {0x9513, 4}, {0x9514, 4}, {0x951f, 20}, 
	{0x9520, 4}, {0x9521, 4}, {0x9522, 4}, {0x9523, 4}, {0x9524, 4}, {0x952f, 20}, 
	//06-3-14 dongqi
	{0x9530, 4}, {0x9531, 4}, {0x9532, 4}, {0x9533, 4}, {0x9534, 4}, {0x953f, 20}, 
	{0x9540, 4}, {0x9541, 4}, {0x9542, 4}, {0x9543, 4}, {0x9544, 4}, {0x954f, 20}, 
	{0x9550, 4}, {0x9551, 4}, {0x9552, 4}, {0x9553, 4}, {0x9554, 4}, {0x955f, 20}, 
	{0x9560, 4}, {0x9561, 4}, {0x9562, 4}, {0x9563, 4}, {0x9564, 4}, {0x956f, 20}, 
	{0x95ff, 160},
	

	//最大需量48
	{0xa010, 3}, {0xa011, 3}, {0xa012, 3}, {0xa013, 3}, {0xa014, 3}, {0xa01f, 15}, 
	{0xa020, 3}, {0xa021, 3}, {0xa022, 3}, {0xa023, 3}, {0xa024, 3}, {0xa02f, 15}, 
	{0xa110, 3}, {0xa111, 3}, {0xa112, 3}, {0xa113, 3}, {0xa114, 3}, {0xa11f, 15}, 
	{0xa120, 3}, {0xa121, 3}, {0xa122, 3}, {0xa123, 3}, {0xa124, 3}, {0xa12f, 15}, 
	{0xa410, 3}, {0xa411, 3}, {0xa412, 3}, {0xa413, 3}, {0xa414, 3}, {0xa41f, 15}, 
	{0xa420, 3}, {0xa421, 3}, {0xa422, 3}, {0xa423, 3}, {0xa424, 3}, {0xa42f, 15}, 
	{0xa510, 3}, {0xa511, 3}, {0xa512, 3}, {0xa513, 3}, {0xa514, 3}, {0xa51f, 15}, 
	{0xa520, 3}, {0xa521, 3}, {0xa522, 3}, {0xa523, 3}, {0xa524, 3}, {0xa52f, 15}, 

	//最大需量时间48
	{0xb010, 4}, {0xb011, 4}, {0xb012, 4}, {0xb013, 4}, {0xb014, 4}, {0xb01f, 20}, 
	{0xb020, 4}, {0xb021, 4}, {0xb022, 4}, {0xb023, 4}, {0xb024, 4}, {0xb02f, 20}, 
	{0xb110, 4}, {0xb111, 4}, {0xb112, 4}, {0xb113, 4}, {0xb114, 4}, {0xb11f, 20}, 
	{0xb120, 4}, {0xb121, 4}, {0xb122, 4}, {0xb123, 4}, {0xb124, 4}, {0xb12f, 20}, 
	{0xb410, 4}, {0xb411, 4}, {0xb412, 4}, {0xb413, 4}, {0xb414, 4}, {0xb41f, 20}, 
	{0xb420, 4}, {0xb421, 4}, {0xb422, 4}, {0xb423, 4}, {0xb424, 4}, {0xb42f, 20}, 
	{0xb510, 4}, {0xb511, 4}, {0xb512, 4}, {0xb513, 4}, {0xb514, 4}, {0xb51f, 20}, 
	{0xb520, 4}, {0xb521, 4}, {0xb522, 4}, {0xb523, 4}, {0xb524, 4}, {0xb52f, 20}, 

	//记录21
	{0xb210, 4}, {0xb211, 4}, {0xb212, 2}, {0xb213, 2}, {0xb214, 3},
	{0xb310, 2}, {0xb311, 2}, {0xb312, 2}, {0xb313, 2}, {0xb31f, 8},
	{0xb320, 3}, {0xb321, 3}, {0xb322, 3}, {0xb323, 3}, {0xb32f, 12},
	{0xb330, 4}, {0xb331, 4}, {0xb332, 4}, {0xb333, 4}, {0xb33f, 16},
	{0xb340, 4}, {0xb341, 4}, {0xb342, 4}, {0xb343, 4}, {0xb34f, 16},

	//瞬时量23
	{0xb611, 2}, {0xb612, 2}, {0xb613, 2}, {0xb61f, 6}, 
	{0xb621, 2}, {0xb622, 2}, {0xb623, 2}, {0xb62f, 6}, 
	{0xb630, 3}, {0xb631, 3}, {0xb632, 3}, {0xb633, 3}, {0xb63f, 12},  
	{0xb640, 2}, {0xb641, 2}, {0xb642, 2}, {0xb643, 2}, {0xb64f, 8}, 
	{0xb650, 2}, {0xb651, 2}, {0xb652, 2}, {0xb653, 2}, {0xb65f, 8}, 

	//电表状态字13
	{0xc010, 4}, {0xc011, 3}, {0xc020, 1}, {0xc021, 1}, 
	{0xc117, 2},
	{0xc119, 4}, {0xc11a, 4}, 
	{0xc030, 3}, {0xc031, 3}, {0xc035, 2}, {0xc036, 2}, 

	//时段费率9
	{0xc331, 3}, {0xc332, 3}, {0xc333, 3}, {0xc334, 3}, {0xc335, 3}, 
	{0xc336, 3}, {0xc337, 3}, {0xc338, 3}, {0xc33f, 24}, 

	//end
	{0, 0},
};

int get_stdlen(unsigned short itemid)
{
	dl645_item_t *pitem = (dl645_item_t *)dl645_item_tab;
	int len;

	while(0 != pitem->cid) {
		if(pitem->cid == itemid) {
			len =  (int)(pitem->len)&0xff;
			return(len);
		}

		pitem++;
	}

	return 0;
}

USHORT dl645_get_itemid(int idx)
{
	dl645_item_t *pitem = (dl645_item_t *)dl645_item_tab;

	if((idx < 0) || (idx >= DL645_NUMITEM)) return 0;

	pitem += idx;
	return(pitem->cid);
}

